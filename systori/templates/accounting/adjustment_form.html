{% extends "project.html" %}
{% load i18n staticfiles bootstrap customformatting ubrutils amount %}

{% block sidebar %}{% include "project/sidebar.html" with section='invoices' %}{% endblock %}

{% block content %}
  <form method="post" autocomplete="off">{% csrf_token %}

    {% if form.invoice %}
      <div class="form-group">
        <label class="control-label">{% trans "Invoice" %}</label>
        <div>{{ form.invoice.json.invoice_no }} {{ form.invoice.json.title }}</div>
      </div>
    {% endif %}

    <style>
      .job-paid,
      .job-invoiced,
      .job-billable,
      .job-approved,
      .job-adjustment,
      .job-adjustment-gross,
      .job-refund,
      .job-refund-credit {
        text-align: right;
      }
      .job-paid, .job-adjustment-gross {
        border-left: 2px solid #ddd;
      }
      .net-header {
        border-left: 2px solid #ddd;
        border-right: 2px solid #ddd;
        text-align: center;
      }
      .gross-header {
        text-align: center;
      }
      .adjustment-table-totals,
      .job-adjustment-gross {
        font-weight: bold;
      }
    </style>

    <div class="form-group {% if form.non_form_errors %}has-error{% endif %}">
    {{ form.management_form }}
    <table is="adjustment-table" class="table table-striped">
      <thead>
      <tr>
        <th class="job-name">{% trans 'Job' %}</th>
        <th class="job-paid">{% trans 'Paid' %}</th>
        <th class="job-invoiced">{% trans 'Invoiced' %}</th>
        <th class="job-billable">{% trans 'Billable' %}</th>
        <th class="job-approved">{% trans 'Approved' %}</th>
        <th class="job-adjustment">{% trans 'Adjustment' %}</th>
        <th class="job-refund">{% trans 'Refund' %}</th>
        <th class="job-refund-credit">{% trans 'Applied Refund' %}</th>
      </tr>
      </thead>
      <tbody>
      {% for adjustment in form.forms %}
        <tr is="adjustment-row" class="adjustment-row">
          <td class="job-name">{{ adjustment.job }}{{ adjustment.initial.job.name }}</td>
          {% amount_view "job-paid" adjustment "paid" %}
          {% amount_view "job-invoiced" adjustment "invoiced" %}
          {% amount_view "job-billable" adjustment "billable" %}
          {% amount_input "job-approved" adjustment "approved" %}
          {% amount_input "job-adjustment" adjustment "adjustment" %}
          {% amount_stateful "job-refund" adjustment "refund" %}
          {% amount_stateful "job-refund-credit" adjustment "refund_credit" %}
        </tr>
      {% endfor %}
        <tr class="adjustment-table-totals">
          <td class="job-name"></td>
          {% amount_view "job-paid" form "paid_total" %}
          {% amount_view "job-invoiced" form "invoiced_total" %}
          {% amount_view "job-billable" form "billable_total" %}
          {% amount_view "job-approved" form "approved_total" %}
          {% amount_view "job-adjustment" form "adjustment_total" %}
          {% amount_view "job-refund" form "refund_total" %}
          {% amount_view "job-refund-credit" form "refund_credit_total" %}
        </tr>
      </tbody>
    </table>
    {% for error in form.non_form_errors %}
      <span class="help-block ">{{ error }}</span>
    {% endfor %}
    </div>

    <div class="form-group">
      <button name="save" type="submit" class="btn btn-primary" value="{% trans 'Save' %}">{% trans 'Save' %}</button>
    </div>
  </form>
{% endblock %}

{% block extra_js %}
  <script type="application/dart" src="{% static "dart/adjustment_editor.dart" %}"></script>
  <script src="{% static "dart/packages/web_components/webcomponents.min.js" %}"></script>
  <script src="{% static "dart/packages/web_components/dart_support.js" %}"></script>
  <script src="{% static "dart/packages/browser/dart.js" %}"></script>
{% endblock extra_js %}
