{% load i18n staticfiles %}

<div class="panel panel-default">

  <div class="panel-heading">
      <span class="pull-right">{{ dailyplan.day|date:'DATE_FORMAT' }}</span>
      {{ jobsite.name }}<br />
      {{ jobsite.address }} {{ jobsite.city }}
  </div>

  {% if dailyplan.id %}

  <div class="list-group">

    <div class="list-group-item sub-header">
      {% trans "Workers" %}
    </div>

  {% for worker in dailyplan.members.all %}

    <div class="list-group-item nav nav-pills">
      {{ worker.member.get_full_name }}

      {% if user.is_staff %}
        <a href="{% url 'field.labor.toggle.role' jobsite.id dailyplan.url_id worker.id %}" class="btn btn-primary pull-right">
      {% else %}
        <span class="pull-right">
      {% endif %}

      {% if worker.is_foreman %}
        {% trans 'Foreman' %}
      {% else %}
        {% trans 'Laborer' %}
      {% endif %}

      {% if user.is_staff %}
        </a>
      {% else %}
        </span>
      {% endif %}

    </div>

  {% empty %}

    <div class="list-group-item">
      {% trans "No workers have been assigned." %}
    </div>

  {% endfor %}


    <div class="list-group-item sub-header">
      {% trans "Tasks" %}
    </div>

  {% for task in dailyplan.tasks.all %}

    <a href="{% url 'field.task' jobsite.id dailyplan.url_id task.id %}" class="list-group-item clearfix">{{ task.name }} <span class="pull-right">&raquo;</span></a>

  {% empty %}

    <div class="list-group-item">
      {% trans "No tasks have been assigned." %}
    </div>

  {% endfor %}

  </div>

  {% else %}

  <div class="panel-body">
    {% trans "Nothing planned for today yet." %}
  </div>

  {% endif %}

  <div class="panel-footer clearfix">
      <div class="pull-right">
          {% if user.is_staff %}

          <a href="{% url 'field.labor' jobsite.id dailyplan.url_id %}" class="btn btn-default">{% blocktrans %}Workers{% endblocktrans %} &raquo;</a>

          {% elif dailyplan.id and user in dailyplan.team.all %}

          {% for worker in dailyplan.members.all %}
          {% if worker.member == user %}
          <a href="{% url 'field.remove.self' jobsite.id dailyplan.url_id worker.id %}" class="btn btn-default pull-right">Remove yourself.</a>
          {% endif %}
          {% endfor %}

          {% else %}

          <a href="{% url 'field.add.self' jobsite.id dailyplan.url_id 'foreman' %}" class="btn btn-default">{% blocktrans %}Add yourself as <b>foreman</b>.{% endblocktrans %}</a>
          <a href="{% url 'field.add.self' jobsite.id dailyplan.url_id 'laborer' %}" class="btn btn-default">{% blocktrans %}Add yourself as <b>laborer</b>.{% endblocktrans %}</a>

          {% endif %}

          <a href="{% url 'field.jobs' jobsite.id dailyplan.url_id %}" class="btn btn-default">{% blocktrans %}Tasks{% endblocktrans %} &raquo;</a>

      </div>
  </div>

</div>