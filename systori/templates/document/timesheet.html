{% extends "frame.html" %}
{% load i18n l10n static dartium bootstrap customformatting ubrutils amount %}

{% block menu_dropdown %}{% include "main/menu_dropdown.html" with section='timesheets' %}{% endblock %}

{% block content %}
  <style>
  .table-nonfluid {
     width: auto !important;
  }
  </style>

  <form method="post" autocomplete="off">{% csrf_token %}

    <h2>
      {{ object.json.last_name }},
      {{ object.json.first_name }},
      {{ object.document_date|date:"F Y" }}
      <a href="{% url 'timesheet.pdf' timesheet.pk %}">{% trans "PDF" %}</a>
    </h2>

    <table class="table table-bordered table-hover table-striped table-condensed">

      <thead>
        <tr>
          {% for _ in object.json.work %}
            <th width="3%">{{ forloop.counter }}</th>
          {% endfor %}
          <th width="3%">&#931;</th>
          <th></th>
        </tr>
      </thead>

      {% for project in object.json.projects %}
      <tr>
        {% for total in project.days %}
          <td>{% if total != 0 %}{{ total|todecimalhours }}{% endif %}</td>
        {% endfor %}
        <td class="info">{% if project.total != 0 %}{{ project.total|todecimalhours }}{% endif %}</td>
        <td>{{project.name}}</td>
      </tr>
      {% endfor %}

      {% for special in object.json.special %}
        <tr>
          {% for total in special.days %}
            <td>{% if total != 0 %}{{ total|todecimalhours }}{% endif %}</td>
          {% endfor %}
          <td class="info">{{ special.total|todecimalhours }}</td>
          <td>{{ special.name|lookup:KIND_CHOICES }}</td>
        </tr>
      {% endfor %}

      <tr>
        {% for total in object.json.holiday %}
          <td>{% if total != 0 %}{{ total|todecimalhours }}{% endif %}</td>
        {% endfor %}
        <td class="info">{{ object.json.holiday_total|todecimalhours }}</td>
        <td>{% trans "Holiday" %}</td>
      </tr>

      <tr>
        {% for total in object.json.work %}
          <td class="info">{% if total != 0 %}{{ total|todecimalhours }}{% endif %}</td>
        {% endfor %}
        <td class="info">{{ object.json.work_total|todecimalhours }}</td>
        <td>{% trans "Total" %}</td>
      </tr>

      <tr>
        {% for total in object.json.overtime %}
          <td>{% if total != 0 %}{{ total|todecimalhours }}{% endif %}</td>
        {% endfor %}
        <td>{{ object.json.overtime_total|todecimalhours }}</td>
        <td>{% trans "Overtime" %}</td>
      </tr>

    </table>

    <table class="table table-bordered table-condensed table-nonfluid pull-right">

      <thead>
      <tr>
        <th></th>
        <th>{% trans "Previous" context "timesheet" %}</th>
        <th>{% trans "Correction" context "timesheet" %}</th>
        <th>{{ object.document_date|date:"F" }}</th>
        <th>{% trans "Balance" context "timesheet" %}</th>
      </tr>
      </thead>

      <tr>
        <td>{% trans "Holiday" %}</td>
        <td>{% if object.json.holiday_transferred != 0 %}{{ object.json.holiday_transferred|workdaysverbose }}{% endif %}</td>
        <td>{% if object.json.holiday_correction != 0 %}{{ object.json.holiday_correction|workdaysverbose }}{% endif %}</td>
        <td>{% if object.json.holiday_total != 0 %}{{ object.json.holiday_total|dayshoursgainedverbose }}{% endif %}</td>
        <td class="info">{{ object.json.holiday_balance|toworkdays }} {{ object.json.holiday_balance|workdayslabel }} ({{ object.json.holiday_balance|todecimalhours }} {{ object.json.holiday_balance|hourslabel }})</td>
      </tr>

      <tr>
        <td>{% trans "Overtime" %}</td>
        <td>{% if object.json.overtime_transferred != 0 %}{{ object.json.overtime_transferred|hoursverbose }}{% endif %}</td>
        <td>{% if object.json.overtime_correction != 0 %}{{ object.json.overtime_correction|hoursverbose }}{% endif %}</td>
        <td>{% if object.json.overtime_total != 0 %}{{ object.json.overtime_total|hoursverbose }}{% endif %}</td>
        <td class="info">{% if object.json.overtime_balance != 0 %}{{ object.json.overtime_balance|hoursdays }}{% endif %}</td>
      </tr>

      <tr>
        <td>{% trans "Final Total" context "timesheet" %}</td>
        <td></td>
        <td>{% if object.json.work_correction != 0 %}{{ object.json.work_correction|hoursverbose }}{% endif %}</td>
        <td>{{ object.json.work_total|hoursverbose }}</td>
        <td class="info">{{ object.json.work_balance|hoursverbose }}</td>
      </tr>

    </table>

    <div class="clearfix"></div>

    {{ form|bootstrap }}
    <div class="form-group">
      <button name="save" type="submit" class="btn btn-primary" value="{% trans 'Save' %}">{% trans 'Save' %}</button>
    </div>
  </form>
{% endblock %}

{% block extra_js %}
  {% dart "payment_editor.dart" %}
{% endblock extra_js %}
