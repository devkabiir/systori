{% extends "base.html" %}
{% load static i18n l10n customformatting %}

{% debug %}

{% block head %}
  {{ block.super }}
{% endblock %}

{% block header %}
  <div style="font-size:20px; height:100%; position:relative;">
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" style="margin:0px;">
    <div class="container-fluid">

      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">{% trans 'Toggle navigation' %}</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Systori</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">

        <ul class="nav navbar-nav">
          <li><a href="{{ previous_day_url }}">{% trans 'back' %}</a></li>
          <li><a>{{ request.selected_day|date:"l" }} {{ request.selected_day|localize }}</a></li>
          <li><a href="{{ next_day_url }}">{% trans 'next' %}</a></li>
        </ul>
        <a class="navbar-brand pull-right">{% trans 'Updated' %} <span class="timeago" title="{% now "c" %}">{% trans "less than a minute ago" %}</span></a>

      </div>
    </div>
  </nav>
{% endblock %}


{% block container %}

  <div class="overview-wrapper">
    {% for plan in selected_plans %}
      <div class="overview-box">
        <div class="panel panel-default dailyplan" data-id="{{ plan.id }}">
          <div class="panel-heading panel-custom">
            {{ plan.jobsite.project.name }}
          </div>
          <div class="panel-body panel-custom" style="background-color:rgba(50,250,50,0.2); color:rgba(15,15,15,0.7);">
            {{ plan.jobsite.name }} </br>
            {{ plan.jobsite.address }} - {{ plan.jobsite.city }}
          </div>
          {% for worker in plan.workers.all %}
            {% if worker.is_foreman %}
              <div class="panel-body panel-custom">
                {{ worker.access.user.get_full_name }} <span style="color:#4ABEF7;">♔</span>
              </div>
            {% else %}
              <div class="panel-body panel-custom">
                {{ worker.access.user.get_full_name }}
              </div>
            {% endif %}
          {% endfor %}
          {% for equipment in plan.equipment.all %}
            <div class="panel-body panel-custom">
              {{ equipment }} <span style="color:#4ABEF7;">♘</span>
            </div>
          {% endfor %}
        </div>
        </ul>
      </div>
    {% endfor %}
  </div>
  <div class="notes-container">
    <div class="notes-box">
      <div class="panel panel-info">
        <div class="panel-heading">{% trans 'Notes' %}</div>
        <div class="panel-body">
          {% for plan in selected_plans %}
            {% if plan.notes %}
              &#9733; <span class="notes-project">{{ plan.jobsite.project.name }}</span> {{ plan.notes }}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  </div>
{% endblock %}

{% block extra_js %}

  {% include "main/timeago_js.html" %}

  <script type="text/javascript">
  $(document).ready(function(){
    setInterval(function() {page_reload()}, 5000);

    $("span.timeago").timeago();

    });

  function page_reload()
  {
    $.ajax({
      type: "HEAD",
      url: window.location,
      success: function() {
        window.location.reload();
      },
      error: function() {
        console.log("error reloading page.");
      },
      statusCode: {
        404: function() { console.log("404"); },
        501: function() { console.log("501"); },
        502: function() { console.log("502"); }
      }
    });
  };

  </script>
{% endblock %}
