{% extends "frame.html" %}
{% load i18n bootstrap %}

{% block sidebar %}{% include "main/sidebar.html" with section='projects' %}{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-xs-8">
      <form role="form" action="{% url 'projects' %}">
          <legend>{% trans 'Project Filter' %}</legend>
          {% csrf_token %}
          <div id="id_search_option" class="row">
            {% for field in form.search_option %}
            <div class="col-xs-12 col-sm-6 col-md-6 col-lg-4">
              {{ field.label }} {{ field }}
            </div>
            {% endfor %}
          </div>
          {{ form.search_term|bootstrap_inline }}
          <div class="form-group">
            <button type="submit" class="btn btn-primary" value="Search">{% trans 'Search' %}</button>
          </div>
      </form>
    </div>
    <div class="col-xs-4">
      <legend>{% trans 'New Project' %}</legend>
      <p>
        <a href="{% url 'project.create' %}">{% trans "Create" %}</a> {% trans "or" %}
        <a href="{% url 'project.import' %}">{% trans "GAEB-Import (experimental)" %}</a>
      </p>
    </div>
  </div>

{% if project_list.count > 20 %}

  <ul id="tabbed_projects" class="nav nav-tabs" role="tablist">
  {% for phase, projects in project_groups.items %}
      <li role="presentation" {% if forloop.counter == 1 %}class="active"{% endif %}>
        <a style="border-bottom: 3px solid
                {% if phase == "prospective" %} HotPink;"
                {% elif phase == "tendering" %} Gold;"
                {% elif phase == "planning" %} Green;"
                {% elif phase == "executing" %} DodgerBlue;"
                {% elif phase == "settlement" %} FireBrick;"
                {% elif phase == "warranty" %} #C6C6CC;"
                {% elif phase == "finished" %} #EEEEEE;"
                {% else %} inherit;"
                {% endif %}
      href="#{{ phase }}" aria-controls="{{ phase }}" role="tab" data-toggle="tab">{{ projects.0.get_phase_display }}</a>
      </li>
  {% endfor %}
  </ul>

  <!-- Tab panes -->
  <div class="tab-content">
    {%  for phase, projects in project_groups.items %}
      <div role="tabpanel" class="tab-pane {% if forloop.counter == 1 %}active{% endif %}" id="{{ phase }}">

        <table class="table table-striped" id="table">
        <thead>
        <tr>
          <th class="hidden-xs">#</th>
          <th>{% trans 'Name' %}</th>
          <th>{% trans 'City' %}</th>
          <th>{% trans 'State' %}</th>
          <th>{% trans 'Actions' %}</th>
        </tr>
        </thead>
        <tbody>
          {% if projects %}
            {% for project in projects %}
              <tr data-phase="{{ phase }}">
                <td width="5%" class="hidden-xs">{{ project.id }}</td>
                <td width="40%"><a href="{% url 'project.view' project.id %}">{{ project }}</a></td>
                <td width="30%">{{ project.jobsites.all.0.city }}</td>
                <td width="10%">{{ project.get_state_display }}</td>
                <td width="15%">
                  <a href="{% url 'project.edit' project.id %}">{% trans "Edit" %}</a>
                  <a href="{% url 'project.delete' project.id %}">{% trans "Delete" %}</a>
                </td>
              </tr>
            {% endfor %}
          {% endif %}
        </tbody>
        </table>

      </div>
    {% endfor %}
  </div>

{% else %}

  <table class="table table-striped" id="table">
    <thead>
    <tr>
      <th class="hidden-xs">#</th>
      <th>{% trans 'Name' %}</th>
      <th>{% trans 'City' %}</th>
      <th>{% trans 'State' %}</th>
      <th>{% trans 'Actions' %}</th>
    </tr>
    </thead>
    <tbody>
      {% for phase, projects in project_groups.items %}
        {% with display_phase=projects.0.get_phase_display %}
          {% if projects %}
              <tr style="background-color:
                {% if phase == "prospective" %} HotPink;">
                {% elif phase == "tendering" %} Gold;">
                {% elif phase == "planning" %} Green;">
                {% elif phase == "executing" %} DodgerBlue;">
                {% elif phase == "settlement" %} FireBrick;">
                {% elif phase == "warranty" %} #C6C6CC;">
                {% elif phase == "finished" %} #EEEEEE;">
                {% else %} inherit;">
                {% endif %}
                <td colspan="5" align="center"><b>{{ display_phase }}</b></td>
              </tr>
            {% for project in projects %}
              <tr data-phase="{{ phase }}">
                <td width="5%" class="hidden-xs">{{ project.id }}</td>
                <td width="40%"><a href="{% url 'project.view' project.id %}">{{ project }}</a></td>
                <td width="30%">{{ project.jobsites.all.0.city }}</td>
                <td width="10%">{{ project.get_state_display }}</td>
                <td width="15%">
                  <a href="{% url 'project.edit' project.id %}">{% trans "Edit" %}</a>
                  <a href="{% url 'project.delete' project.id %}">{% trans "Delete" %}</a>
                </td>
              </tr>
            {% endfor %}
          {% endif %}
        {% endwith %}
      {% endfor %}
    </tbody>
  </table>

  <p>
    {% if not phase_filter %}
      <a href="{% url 'projects' 'finished' %}">
        {% trans "Finished" as finished_phase %}
        {% blocktrans with phase=finished_phase %}Show {{ phase }} Projects{% endblocktrans %}
      </a>
    {% elif phase_filter %}
      <a href="{% url 'projects' %}">{% trans 'Show All Projects' %}</a>
    {% endif %}
  </p>

{% endif %}
{% endblock content %}

{% block extra_js %}
<script type="text/javascript">
  $('#tabbed_projects a').click(function (e) {
    e.preventDefault()
    $(this).tab('show')
  })
</script>
{% endblock %}