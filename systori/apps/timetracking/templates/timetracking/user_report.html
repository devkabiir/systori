{% extends "frame.html" %}
{% load i18n static bootstrap timetracking %}

{% block head %}
{{ block.super }}
<style type="text/css">
  #id_user {
    width: 200px;
  }
  #id_duration {
    width: 80px !important;
  }
</style>
{{ form.media.css }}

{# This is here because of the datepicker init calls in the body #}
<script src="{% static "js/jquery-1.11.2.min.js" %}"></script>
<script src="{% static "js/jquery-ui.min.js" %}"></script>
<script src="{% static "js/bootstrap.min.js" %}"></script>

{# <script type="application/dart" src="{% static "dart/timetracking.dart" %}"></script> #}
<script type="application/dart" src="{% static "dart/timetracking_report.dart" %}"></script>
<script src="{% static "dart/packages/web_components/webcomponents.min.js" %}"></script>
<script src="{% static "dart/packages/web_components/dart_support.js" %}"></script>
<script src="{% static "dart/packages/browser/dart.js" %}"></script>
{{ form.media.js }}
{% endblock head %}

{% block sidebar %}{% include "main/sidebar.html" with section='timetracking' %}{% endblock %}

{% block content %}
<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">{{ user.get_full_name }} {% trans "Time Report for" %} {% now "F" %}</h3>
  </div>
  <div class="panel-body">
    <form class="form-inline" method="POST">
    {% csrf_token %}
    {{ form|bootstrap_inline }}
      <div class="form-group">
        <div class="col-sm-10 col-sm-offset-2">
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </div>
    </form>
  </div>

  <table class="table table-striped table-bordered" id="timer-report">
    <tr>
      <th>{% trans "Date" %}</th>
      <th>{% trans "Activity" %}</th>
      <th>{% trans "Start" %}</th>
      <th>{% trans "End" %}</th>
      <th>{% trans "Hours" %}</th>
      <th>{% trans "Overtime" %}</th>
      <th>{% trans "Total Hours" %}</th>
    </tr>
    {% for date, date_entries in report.rows.items %}
      {% for row in date_entries %}
    <tr>
      <td>{{ date }}</td>
      {% if row.kind == 'work' %}
      <td>Work</td>
      <td>{{ row.day_start|date:"H:i" }}</td>
      <td>{{ row.day_end |date:"H:i"}}</td>
      <td>{{ row.total|seconds_to_hours }}</td>
      <td>{{ row.overtime|seconds_to_hours}}</td>
      <td>{{ row.total_duration|seconds_to_hours }}</td>
      {% elif row.kind == 'holiday' %}
      <td>Holiday</td>
      <td colspan="5">{{ row.total_duration|seconds_to_hours }}</td>
      {% elif row.kind == 'illness' %}
      <td>Illness</td>
      <td>{{ row.day_start|date:"H:i" }}</td>
      <td colspan="4">{{ row.total_duration|seconds_to_hours }}</td>
      {% else %}
      <td colspan="6">â€”</td>
      {% endif %}
    </tr>
      {% endfor %}
    {% empty %}
    <tr><td colspan="5">{% trans "No entries" %}</td></tr>
    {% endfor %}
  </table>
</div>

<div class="panel panel-default">
  <table class="table table-striped table-bordered">
    <tr>
      <td>Holidays used</td><td>{{ report.holidays_used }}</td>
    </tr>
    <tr>
      <td>Holidays available</td><td>{{ report.holidays_available }}</td>
    </tr>
    <tr>
      <td>Overtime</td><td>{{ report.overtime|seconds_to_hours }}</td>
    </tr>
  </table>
</div>
{% endblock %}

{% block base_js %}{% endblock %}
