{% extends "project.html" %}
{% load i18n staticfiles %}

{% block title %}{{ project.name }} > {{ job.name }}{% endblock %}
{% block head_navbar %}
<ul class="nav navbar-nav navbar-left">
  <li><a href="{% url 'project.view' project.id %}">{{ project.name }}</a></li>
  <li class="active"><a href="{% url 'tasks' project.id job.id %}">{{ job.name }}</a></li>
</ul>
{% endblock %}

{% block sidebar %}{% include "project/sidebar.html" with section='jobs' %}{% endblock %}

{% block content %}
<style>

#task-editor {
}

ubr-taskgroup,
ubr-task,
ubr-taskinstance,
ubr-lineitem {
  display: block;
  position: relative;
}

.editor {
  position: relative;
  padding-bottom: 10px;
}

.editor-row {
  display: flex;
}

/* task group & task */

.code {
  width: 80px;
}

.description {
  margin-left: 80px;
  padding-right: 10px;
  width: 612px;
}

.qty {
  width: 90px;
  text-align: right;
}

.unit {
  width: 90px;
  padding-left: 4px;
}

.price {
  width: 90px;
  text-align: right;
  padding-right: 4px;
}

.total {
  width: 90px;
  font-weight: bold;
  text-align: right;
  padding-right: 4px;
  margin-left: 10px;
}

.labels {
  padding-left: 20px;
}

.labels > .label:hover {
  cursor: pointer;
}

.labels > .label.False {
  display: none;
  background-color: #F0F0F0;
}

.editor:hover > .editor-row > .labels > .label.False {
  display: inline;
}

/* task group */

ubr-taskgroup > .editor .name {
  font-weight: bold;
  width: 700px;
}

ubr-taskgroup > .editor .total {
  width: 100px;
  border: 1px solid black;
  background-color: #fff;
  z-index: 2;
}

ubr-taskgroup:not(.empty) > .editor:after {
  display: block;
  position: absolute;
  content: "";
  border-left: 1px solid #e9e9e9;
  top: 0px;
  bottom: 0px;
  left: 791px;
  z-index: 1;
}

/* task */

ubr-task:not(:last-child):after {
  display: block;
  position: absolute;
  content: "";
  border-left: 1px solid #e9e9e9;
  top: 0px;
  bottom: 0px;
  left: 791px;
  z-index: 1;
}

ubr-task > .editor {
  padding-bottom: 0px;
}

ubr-task > .editor .code {
  padding-left: 10px;
}

ubr-task > .editor .name {
  width: 420px;
}

ubr-task > .editor .price {
  position: relative;
  font-weight: bold;
  border: 1px solid black;
  margin-left: 10px;
}

ubr-task > .editor .price:before {
  display: block;
  position: absolute;
  content: "x";
  width: 180px;
  height: 1px;
  padding-right: 2px;
  border-top: 1px solid #e9e9e9;
  top: -1px;
  left: -181px;
  color: #e9e9e9;
  font-size: 8px;
  text-align: right;
}

ubr-task > .editor .price:after {
  display: block;
  position: absolute;
  content: "=";
  width: 10px;
  padding-left: 2px;
  border-top: 1px solid #e9e9e9;
  top: 1px;
  right: -11px;
  color: #e9e9e9;
  font-size: 8px;
  text-align: left;
}

ubr-task > .editor .total {
  width: 100px;
  border: 1px solid #e9e9e9;
  background-color: #fff;
  z-index: 2;
}

ubr-task > .editor .total:before {
  display: block;
  position: absolute;
  content: "+";
  height: 10px;
  top: -10px;
  color: #e9e9e9;
  font-size: 9px;
  text-align: left;
  padding-left: 2px;
}

ubr-task > .editor .description {
  padding-bottom: 15px;
}

ubr-task:not(.empty) > .editor .description {
  padding-bottom: 20px;
  border-right: 1px solid #e9e9e9;
}

/* task instance */

ubr-taskinstance:nth-of-type(1) > .editor {
  width: 692px;
  border-right: 1px solid #e9e9e9;
}

ubr-taskinstance:nth-of-type(1) > ubr-lineitem > .editor .total {
  border: 1px solid #e9e9e9;
}

ubr-taskinstance:nth-of-type(1) > ubr-lineitem > .editor .total:before {
  display: block;
  position: absolute;
  content: "+";
  height: 10px;
  border-left: 1px solid #e9e9e9;
  top: -10px;
  color: #e9e9e9;
  font-size: 9px;
  text-align: left;
  padding-left: 2px;
}

ubr-taskinstance:last-of-type {
  padding-bottom: 40px;
}


/* line item */

ubr-lineitem .name {
  width: 310px;
  margin-left: 100px;
}

ubr-lineitem .price {
}

div[contenteditable][placeholder]:empty:before {
  content: attr(placeholder);
  font-style: italic;
  color: #d9d9d9;
}

div[contenteditable][placeholder]:empty:focus:before {
  content: "";
}

ubr-autocomplete {
  z-index: 100;
  display: none;
  position: absolute;
  background: white;
  left: 80px;
  width: 310px;
  border: 1px solid lightgrey;
}

ubr-autocomplete > div {
  border-bottom: 1px solid lightgrey;
}
/*
ubr-autocomplete > div:hover {
  background: #FFE8D9;
  cursor: pointer;
}
*/

ubr-autocomplete > div.active {
  background: orange;
}

#mode-selector {
  position: fixed;
  top: 60px;
  right: 10px;
}

</style>

<div id="mode-selector" class="btn-group-vertical" data-toggle="buttons">
  <label id="input-task-mode" class="btn btn-default btn-sm" title="{% trans "Stops indenting at the tasks level." %}">
    <input type="radio" name="input-mode"><span class="glyphicon glyphicon-step-forward"></span>
  </label>
  <label id="input-lineitem-mode" class="btn btn-default btn-sm active" title="{% trans 'Stops indenting at line items level.' %}">
    <input type="radio" name="input-mode"><span class="glyphicon glyphicon-fast-forward"></span>
  </label>
</div>

<ubr-job id="task-editor"
  data-pk="{{ job.pk }}"
  data-code="{{ job.code }}"
  data-taskgroup-offset="{{ job.taskgroup_offset }}"
  data-taskgroup-zfill="{{ project.taskgroup_zfill }}"
  data-task-zfill="{{ project.task_zfill }}">

  {% for group in object_list %}
    {% include "task/taskgroup_loop.html" with group=group %}
  {% endfor %}

</ubr-job>

<template id="taskgroup-template">
  {% include "task/taskgroup_editor.html" with group=blank_taskgroup %}
</template>

<template id="task-template">
  {% include "task/task_editor.html" with task=blank_task %}
</template>

<template id="taskinstance-template">
  {% include "task/taskinstance_editor.html" with task=blank_taskinstance %}
</template>

<template id="lineitem-template">
  {% include "task/lineitem_editor.html" with lineitem=blank_lineitem %}
</template>

{% endblock content %}

{% block extra_js%}
<script type="application/dart" src="{% static "editor/editor.dart" %}"></script>
<script type="text/javascript" src="{% static "editor/packages/browser/dart.js" %}"></script>
{% endblock extra_js%}
