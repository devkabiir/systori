
{% load latex i18n l10n customformatting %}
\documentclass[10pt, oneside]{letter}
\usepackage[utf8x]{inputenc}

\usepackage{wallpaper, array, longtable, tabu, booktabs, eurosym, lastpage}
% wallpaper = wallpaper pdf, array to stretch the table,
% longtable break page for tables
% tabu variable width columns for table
% booktabs beautify table
% eurosym for the â‚¬ symbol
% lastpage for footer Page X of LastPage

\usepackage[defaultsans]{droidsans}
\renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be typewriter style
\usepackage[T1]{fontenc}
% droidsans font

{% if add_letterhead %}
\ThisULCornerWallPaper{1}{softronic_page1_parts.pdf}
\ULCornerWallPaper{1}{softronic_page2.pdf}
{% endif %}

% general page setup
\usepackage[a4paper,top=55mm,bottom=22mm,left=25mm,right=62mm]{geometry}
\usepackage{fancyhdr}%custom header package
\pagestyle{fancy}%custom header
\fancyhf{}%clear all
\renewcommand{\headrulewidth}{0pt}%clear head line
\rfoot{ {% trans 'Page' %} \thepage\ {% trans 'of' %} \pageref{LastPage}}

%settings for longtable/tabu
\renewcommand*{\arraystretch}{1.5}
{\setlength{\tabcolsep}{0.5mm}

\usepackage{ragged2e}
\RaggedRight

\begin{document}
\sloppy
\begin{letter}

{% autoescape off %}

{% if contact.business %}{{ contact.business }} \\{% endif %}
z.H. {{ contact.salutation|tex_escape }} {{ contact.first_name|tex_escape }} {{ contact.last_name|tex_escape }} \\
{{ contact.address|tex_escape }} \\
{{ contact.postal_code|tex_escape }} {{ contact.city|tex_escape }} \\

\vspace{15mm}

\begin{flushright}
{{ doc.document_date.date|localize }}
\end{flushright}
{{ doc.header|tex_escape }}

\begin{longtabu} to \textwidth{@{}l X[l] r l r r}

{% filter bold %}{% trans 'Pos.' %}{% endfilter %}  & {% filter bold %}{% trans 'Description' %}{% endfilter %} & \multicolumn{2}{c}{ {% filter bold %}{% trans 'Amount' %}{% endfilter %} } & {% filter bold %}{% trans 'Price' %}{% endfilter %} & {% filter bold %}{% trans 'Total'%}{% endfilter %} \\
\hline
\endfirsthead
\multicolumn{6}{l} {\textit{... {% trans 'Continuation' %} }} \\

{% filter bold %}{% trans 'Pos.' %}{% endfilter %}  & {% filter bold %}{% trans 'Description' %}{% endfilter %} & \multicolumn{2}{c}{ {% filter bold %}{% trans 'Amount' %}{% endfilter %} } & {% filter bold %}{% trans 'Price' %}{% endfilter %} & {% filter bold %}{% trans 'Total'%}{% endfilter %} \\
\hline

\endhead
\multicolumn{6}{r}{\textit{ {% trans 'Continuation' %} ...}} \\
\hline
\endfoot

\endlastfoot

{% for job in jobs.all %}
{{job.code|bold}} & \multicolumn{5}{l}{\parbox[t]{11cm}{ {{job.name|tex_escape|bold}} }} \\
{% for taskgroup in job.taskgroups.all %}
{{taskgroup.code|bold}} & \multicolumn{5}{l}{\parbox[t]{11cm}{ {{taskgroup.name|tex_escape|bold}} }} \\

{% for task in taskgroup.tasks.all %}
{% for instance in task.taskinstances.all %}
{{instance.code}}
    & \multicolumn{5}{l}{\parbox[t]{11cm}{ {{instance.full_name|tex_escape}} }} \\*
    & \multicolumn{5}{l}{\parbox[t]{11cm}{ {{instance.full_description|tex_escape}} }} \\*
    & & {{task.qty|ubrdecimal}} & {{task.unit|tex_escape}} & {{instance.unit_price|money}}   & {% if task.is_optional %}{% trans 'Optional' %}{% elif not instance.selected %}{% trans 'alternate'%} {% else %}{{instance.fixed_price_estimate|money}} {% endif %} \\
{% endfor %}
{% endfor %}

% \tabucline{6}
& \multicolumn{4}{r} {\textbf{ {% trans 'Total' %} {{job.code}}.{{forloop.counter}} - {{taskgroup.name|tex_escape}} }} & \textbf{ {{taskgroup.estimate_total|money}}  }\\
\\
{% endfor %}

{% endfor %}

{% for job in jobs.all %}
{% for taskgroup in job.taskgroups.all %}
  & \multicolumn{4}{r} {\textbf{ {% trans 'Total' %} {{job.code}}.{{forloop.counter}} - {{taskgroup.name|tex_escape}} }} & \textbf{ {{taskgroup.estimate_total|money}}  } \\*
{% endfor %}
{% endfor %}

\tabucline{2-6}
& \multicolumn{4}{r} {\textbf{ {% trans 'Total without VAT' %} }} & \textbf{ {{jobs.estimate_total|money}}  } \\*
& \multicolumn{4}{r} {\textbf{19,00\% {% trans 'VAT' %} }} & \textbf{ {{jobs.estimate_tax_total|money}}  } \\*
& \multicolumn{4}{r} {\textbf{ {% trans 'Total including VAT' %} }} & \textbf{ {{jobs.estimate_gross_total|money}}  } \\*

\end{longtabu}

% \setlength{\tabcolsep}{2mm}
% \begin{tabu} to \textwidth{@{} r X[l] }
% {% trans 'method of payment' %} & Zahlbar sofort ohne Abzug.\\*
% {% trans 'validity' %} & Gerichtsstand ist Mannheim. Waren bleiben bis zur restlosen Zahlung unser Eigentum. Es gelten unsere AGBs.\\
% \end{tabu}

% \vspace{5mm}

{{ doc.footer|tex_escape }}
{% endautoescape %}

\end{letter}
\end{document}
