
{% load latex i18n %}
\listfiles
\documentclass[10pt, oneside]{letter}
\usepackage[utf8x]{inputenc}

\usepackage{wallpaper, array, longtable, tabu, booktabs, eurosym, lastpage}
% wallpaper = wallpaper pdf, array to stretch the table,
% longtable break page for tables
% tabu variable width columns for table
% booktabs beautify table
% eurosym for the € symbol
% lastpage for footer Page X of LastPage

\usepackage[defaultsans]{droidsans}
\renewcommand*\familydefault{\sfdefault} %% Only if the base font of the document is to be typewriter style
\usepackage[T1]{fontenc}
% droidsans font

{% if corporate_letterhead %}
\ThisULCornerWallPaper{1}{softronic_page1.pdf}
\ULCornerWallPaper{1}{softronic_page2.pdf}
{% endif %}

% general page setup
\usepackage[a4paper, width=125mm,top=55mm,bottom=22mm, left=25mm]{geometry}
\usepackage{fancyhdr}%custom header package
\pagestyle{fancy}%custom header
\fancyhf{}%clear all
\renewcommand{\headrulewidth}{0pt}%clear head line
\rfoot{ {% trans 'Page' %} \thepage\ {% trans 'of' %} \pageref{LastPage}}

%settings for longtable/tabu
\renewcommand*{\arraystretch}{1.5}
{\setlength{\tabcolsep}{0.5mm}

\begin{document}
\begin{letter}

{% if contact.business %}{{ contact.business }} \\{% endif %}
z.H. {{ contact.salutation }} {{ contact.first_name }} {{ contact.last_name }} \\
{{ contact.address }} \\
{{ contact.postal_code }} {{ contact.city }} \\

\vspace{15mm}

{{ doc.header }}

\begin{longtabu} to \textwidth{@{}l X[l] r l r r}

{% filter bold %}{% trans 'Pos.' %}{% endfilter %}  & {% filter bold %}{% trans 'Description' %}{% endfilter %} & \multicolumn{2}{c}{ {% filter bold %}{% trans 'Amount' %}{% endfilter %} } & {% filter bold %}{% trans 'Price' %}{% endfilter %} & {% filter bold %}{% trans 'Total'%}{% endfilter %} \\
\hline
\endfirsthead
\multicolumn{6}{l} {\textit{... {% trans 'Continuation' %} }} \\

{% filter bold %}{% trans 'Pos.' %}{% endfilter %}  & {% filter bold %}{% trans 'Description' %}{% endfilter %} & \multicolumn{2}{c}{ {% filter bold %}{% trans 'Amount' %}{% endfilter %} } & {% filter bold %}{% trans 'Price' %}{% endfilter %} & {% filter bold %}{% trans 'Total'%}{% endfilter %} \\
\hline

\endhead
\multicolumn{6}{r}{\textit{ {% trans 'Continuation' %} ...}} \\
\hline
\endfoot

\endlastfoot

{% for job in jobs.all %}
{{job.code|bold}} & \multicolumn{4}{l}{\parbox[t]{9cm}{ {{job.name|bold}} }} &\\
{% for taskgroup in job.taskgroups.all %}
{{taskgroup.code|bold}} & \multicolumn{4}{l}{\parbox[t]{9cm}{ {{taskgroup.name|bold}} }} &\\

{% for task in taskgroup.tasks.all %}
{{task.code}}
    & \multicolumn{4}{l}{\parbox[t]{9cm}{ {{task.name}} }} \\*
    & \multicolumn{4}{l}{\parbox[t]{9cm}{ {{task.description}} }} \\*
    & & {{task.qty|floatformat:2}} & {{task.unit}} & {{task.unit_price|floatformat:2}} €  & {% if task.is_optional %}{% trans 'Optional' %}{% else %}{{task.fixed_price_estimate|floatformat:2}} €{% endif %} \\
{% endfor %}

\tabucline{6}
    & \multicolumn{4}{r} {\textbf{ {% trans 'Total' %} {{forloop.counter}} - {{taskgroup.name}} }} & \textbf{ {{taskgroup.estimate_total|floatformat:2}} € }\\
\\
{% endfor %}

{% endfor %}

{% for job in jobs.all %}
{% for taskgroup in job.taskgroups.all %}
& \multicolumn{4}{r} {\textbf{ {% trans 'Total' %} {{forloop.counter}} - {{taskgroup.name}} }} & \textbf{ {{taskgroup.estimate_total|floatformat:2}} € } \\*
{% endfor %}
{% endfor %}

\tabucline{2-6}
& \multicolumn{4}{r} {\textbf{ {% trans 'Total without VAT' %} }} & \textbf{ {{jobs.estimate_total|floatformat:2}} € } \\*
& \multicolumn{4}{r} {\textbf{19,00\% {% trans 'VAT' %} }} & \textbf{ {{jobs.estimate_tax_total|floatformat:2}} € } \\*
& \multicolumn{4}{r} {\textbf{ {% trans 'Total including VAT' %} }} & \textbf{ {{jobs.estimate_gross_total|floatformat:2}} € } \\*

\end{longtabu}

\setlength{\tabcolsep}{2mm}
\begin{tabu} to \textwidth{@{} r X[l] }
method of payment & 2,00\% cash discount when paid within two weeks until the 01.02.2015, after that without rebate.\\*
validity & place of jurisdiction is Mannheim. The goods are until the complete payment our property.\\
\end{tabu}

\vspace{5mm}

{{ doc.footer }}

\end{letter}
\end{document}
